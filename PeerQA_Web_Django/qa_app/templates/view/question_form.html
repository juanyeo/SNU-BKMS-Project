{% extends "view/base.html" %}
{% load static %}

{% block content %}
<h2 class="header_title text-center">ğŸ‘©â€ğŸ’» ê²Œì‹œê¸€ ì‘ì„± ğŸ–‹</h2>
<hr class="h-color mx-2">
<form action="" method="post" id="questionForm" autocomplete="off" data-pages-url="{% url 'ajax_load_pages' %}" data-slide-url="{% url 'ajax_load_slide' %}">
    {% csrf_token %}
    <input type="hidden" id="status" name="status" value="POSTED">
    <input type="hidden" id="user" name="user" value="{{user.id}}">
    <div class="row mt-4">
        <div class="col-12">
          <label style="font-weight: 600; font-size: large;">ì œëª©</label>
          <input type="title" name="title" value="{{title}}" class="form-control" maxlength="200" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
        </div>
    </div>
    <div class="row mt-4">
      <div class="col-12">
        <label style="font-weight: 600; font-size: large;">ë‚´ìš©</label>
        <textarea type="content" name="content" value="{{content}}" class="form-control" rows="7" maxlength="2000" placeholder="ì§ˆë¬¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
      </div>
    </div>
    <div class="row mt-4">
      <div class="col-6">
        <label style="font-weight: 600; font-size: large;">ê°•ì˜ ìë£Œ</label>
        <select id="lecture_name" name="lecture_name" class="custom-select">
          <option value="">ê°•ì˜ ì„ íƒ</option>
          {% for key in lectures %}
          <option value="{{key}}">{{key}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-6">
        <label style="font-weight: 600; font-size: large;">Page</label>
        <select id="lecture_slide" name="lecture_slide" class="custom-select">
          <option value="">í˜ì´ì§€ ì„ íƒ</option>
        </select>
      </div>
  </div>
  <div class="row mt-4">
    <div class="col-12" id="slide_prev">
      <img id="slide_preview" style="height: 200px; display: none;" src="{% static 'image/question.jpeg' %}"></img>
    </div>
  </div>
  <div class="row mt-4">
    <div class="col-6 mt -4">
      <label style="font-weight: 600; font-size: large;"># íƒœê·¸</label>
      <select id="tag" name="tag" class="custom-select">
          <option value="">íƒœê·¸ ì„ íƒ</option>
          {% for tag in tags %}
          <option value="{{tag}}">{{tag}}</option>
          {% endfor %}
      </select>
    </div>
  </div>
  <div class="row mt-4">
      <div class="col-12">
          <button type="submit" class="btn btn-dark btn-lg" style="margin-right: 20px; background: #5E81F4; border: #5E81F4;">ì§ˆë¬¸ê¸€ ë“±ë¡</button>
          <button type="button" class="btn btn-light btn-lg" style="background: #D4DEF1;" onclick="location.href='/question/'">ì·¨ì†Œ</button>
      </div>
  </div>
</form>

<script src="{% static 'js/jquery.js' %}"></script>
<script>
  $("#lecture_name").change(function() {
    var url = $("#questionForm").attr("data-pages-url");
    var lectureName = $(this).val();

    $.ajax({
      url: url,
      data: {'lecture_id': lectureName},
      success: function (data) {
        $("#lecture_slide").html(data);
        $("#slide_preview").hide();
      }
    });
  });

  $("#lecture_slide").change(function() {
    var url = $("#questionForm").attr("data-slide-url");
    var lecture = $("#lecture_name").val();
    var slide = $(this).val();

    $.ajax({
      url: url,
      data: {'lecture': lecture, 'slide': slide},
      success: function (data) {
        $("#slide_preview").show();
        let src_text = String(data);
        $("#slide_preview").attr("src", src_text);
      }
    });
  });
</script>
{% endblock content %}